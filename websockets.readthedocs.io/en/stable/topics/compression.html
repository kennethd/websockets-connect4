<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Compression" />
<meta property="og:type" content="website" />
<meta property="og:url" content="topics/compression.html" />
<meta property="og:site_name" content="websockets" />
<meta property="og:description" content="Most WebSocket servers exchange JSON messages because they’re convenient to parse and serialize in a browser. These messages contain text data and tend to be repetitive. This makes the stream of me..." />
<meta name="description" content="Most WebSocket servers exchange JSON messages because they’re convenient to parse and serialize in a browser. These messages contain text data and tend to be repetitive. This makes the stream of me..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Keepalive and latency" href="keepalive.html" /><link rel="prev" title="Broadcasting" href="broadcast.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Compression - websockets 14.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=a746c00c.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css%3Fv=354aac6f.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css%3Fv=4c969af8.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css%3Fv=302659d7.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #306998;
  --color-brand-content: #0b487a;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
      }
    }
  }
</style><script async type="text/javascript" src="../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="websockets" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/topics/compression.html" /><meta name="readthedocs-http-status" content="200" /></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="compression.html#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">websockets 14.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/websockets.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial1.html">Part 1 - Send &amp; receive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial2.html">Part 2 - Route &amp; broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial3.html">Part 3 - Deploy to the web</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../howto/index.html">How-to guides</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../howto/quickstart.html">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/upgrade.html">Upgrade to the new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code> implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/cheatsheet.html">Cheat sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/autoreload.html">Reload on code changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/django.html">Integrate with Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/extensions.html">Write an extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/render.html">Deploy to Render</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/fly.html">Deploy to Fly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/heroku.html">Deploy to Heroku</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/kubernetes.html">Deploy to Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/supervisor.html">Deploy with Supervisor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/nginx.html">Deploy behind nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/haproxy.html">Deploy behind HAProxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howto/sansio.html">Integrate the Sans-I/O layer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">Frequently asked questions</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Frequently asked questions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/server.html">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/common.html">Both sides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/asyncio.html">Using asyncio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/features.html">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/server.html">Server (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/client.html">Client (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/server.html">Server (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/client.html">Client (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/server.html">Server (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/client.html">Client (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/server.html">Server (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/client.html">Client (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/extensions.html">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/datastructures.html">Data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/variables.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Topic guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Topic guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="broadcast.html">Broadcasting</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="compression.html#">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="keepalive.html">Keepalive and latency</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory.html">Memory and buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="performance.html">Performance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../project/index.html">About websockets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of About websockets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../project/changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/sponsoring.html">Sponsoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/tidelift.html">For enterprise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/support.html">Getting support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/license.html">License</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="compression.html#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="compression">
<h1>Compression<a class="headerlink" href="compression.html#compression" title="Link to this heading">¶</a></h1>
<p>Most WebSocket servers exchange JSON messages because they’re convenient to
parse and serialize in a browser. These messages contain text data and tend to
be repetitive.</p>
<p>This makes the stream of messages highly compressible. Compressing messages
can reduce network traffic by more than 80%.</p>
<p>websockets implements WebSocket Per-Message Deflate, a compression extension
based on the <a class="reference external" href="https://en.wikipedia.org/wiki/Deflate">Deflate</a> algorithm specified in <span class="target" id="index-0"></span><a class="rfc reference external" href="https://datatracker.ietf.org/doc/html/rfc7692.html"><strong>RFC 7692</strong></a>.</p>
<p><a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> enable compression by default because
the reduction in network bandwidth is usually worth the additional memory and
CPU cost.</p>
<section id="configuring-compression">
<h2>Configuring compression<a class="headerlink" href="compression.html#configuring-compression" title="Link to this heading">¶</a></h2>
<p>To disable compression, set <code class="docutils literal notranslate"><span class="pre">compression=None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>To customize compression settings, enable the Per-Message Deflate extension
explicitly with <a class="reference internal" href="../reference/extensions.html#websockets.extensions.permessage_deflate.ClientPerMessageDeflateFactory" title="websockets.extensions.permessage_deflate.ClientPerMessageDeflateFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientPerMessageDeflateFactory</span></code></a> or
<a class="reference internal" href="../reference/extensions.html#websockets.extensions.permessage_deflate.ServerPerMessageDeflateFactory" title="websockets.extensions.permessage_deflate.ServerPerMessageDeflateFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerPerMessageDeflateFactory</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.extensions</span> <span class="kn">import</span> <span class="n">permessage_deflate</span>

<span class="n">connect</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">permessage_deflate</span><span class="o">.</span><span class="n">ClientPerMessageDeflateFactory</span><span class="p">(</span>
            <span class="n">server_max_window_bits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">client_max_window_bits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">compress_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memLevel&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">serve</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">permessage_deflate</span><span class="o">.</span><span class="n">ServerPerMessageDeflateFactory</span><span class="p">(</span>
            <span class="n">server_max_window_bits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">client_max_window_bits</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">compress_settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;memLevel&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
        <span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The Window Bits and Memory Level values in these examples reduce memory usage
at the expense of compression rate.</p>
</section>
<section id="compression-parameters">
<h2>Compression parameters<a class="headerlink" href="compression.html#compression-parameters" title="Link to this heading">¶</a></h2>
<p>When a client and a server enable the Per-Message Deflate extension, they
negotiate two parameters to guarantee compatibility between compression and
decompression. These parameters affect the trade-off between compression rate
and memory usage for both sides.</p>
<ul>
<li><p><strong>Context Takeover</strong> means that the compression context is retained between
messages. In other words, compression is applied to the stream of messages
rather than to each message individually.</p>
<p>Context takeover should remain enabled to get good performance on
applications that send a stream of messages with similar structure,
that is, most applications.</p>
<p>This requires retaining the compression context and state between messages,
which increases the memory footprint of a connection.</p>
</li>
<li><p><strong>Window Bits</strong> controls the size of the compression context. It must be an
integer between 9 (lowest memory usage) and 15 (best compression). Setting it
to 8 is possible but rejected by some versions of zlib and not very useful.</p>
<p>On the server side, websockets defaults to 12. Specifically, the compression
window size (server to client) is always 12 while the decompression window
(client to server) size may be 12 or 15 depending on whether the client
supports configuring it.</p>
<p>On the client side, websockets lets the server pick a suitable value, which
has the same effect as defaulting to 15.</p>
</li>
</ul>
<p><a class="reference external" href="https://docs.python.org/3/library/zlib.html#module-zlib" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">zlib</span></code></a> offers additional parameters for tuning compression. They control
the trade-off between compression rate, memory usage, and CPU usage for
compressing. They’re transparent for decompressing.</p>
<ul>
<li><p><strong>Memory Level</strong> controls the size of the compression state. It must be an
integer between 1 (lowest memory usage) and 9 (best compression).</p>
<p>websockets defaults to 5. This is lower than zlib’s default of 8. Not only
does a lower memory level reduce memory usage, but it can also increase
speed thanks to memory locality.</p>
</li>
<li><p><strong>Compression Level</strong> controls the effort to optimize compression. It must
be an integer between 1 (lowest CPU usage) and 9 (best compression).</p>
<p>websockets relies on the default value chosen by <a class="reference external" href="https://docs.python.org/3/library/zlib.html#zlib.compressobj" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">compressobj()</span></code></a>,
<code class="docutils literal notranslate"><span class="pre">Z_DEFAULT_COMPRESSION</span></code>.</p>
</li>
<li><p><strong>Strategy</strong> selects the compression strategy. The best choice depends on
the type of data being compressed.</p>
<p>websockets relies on the default value chosen by <a class="reference external" href="https://docs.python.org/3/library/zlib.html#zlib.compressobj" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">compressobj()</span></code></a>,
<code class="docutils literal notranslate"><span class="pre">Z_DEFAULT_STRATEGY</span></code>.</p>
</li>
</ul>
<p>To customize these parameters, add keyword arguments for
<a class="reference external" href="https://docs.python.org/3/library/zlib.html#zlib.compressobj" title="(in Python v3.13)"><code class="xref py py-func docutils literal notranslate"><span class="pre">compressobj()</span></code></a> in <code class="docutils literal notranslate"><span class="pre">compress_settings</span></code>.</p>
</section>
<section id="default-settings-for-servers">
<h2>Default settings for servers<a class="headerlink" href="compression.html#default-settings-for-servers" title="Link to this heading">¶</a></h2>
<p>By default, websockets enables compression with conservative settings that
optimize memory usage at the cost of a slightly worse compression rate:
Window Bits = 12 and Memory Level = 5. This strikes a good balance for small
messages that are typical of WebSocket servers.</p>
<p>Here’s an example of how compression settings affect memory usage per
connection, compressed size, and compression time for a corpus of JSON
documents.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Window Bits</p></th>
<th class="head"><p>Memory Level</p></th>
<th class="head"><p>Memory usage</p></th>
<th class="head"><p>Size vs. default</p></th>
<th class="head"><p>Time vs. default</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>15</p></td>
<td><p>8</p></td>
<td><p>316 KiB</p></td>
<td><p>-10%</p></td>
<td><p>+10%</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>7</p></td>
<td><p>172 KiB</p></td>
<td><p>-7%</p></td>
<td><p>+5%</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>6</p></td>
<td><p>100 KiB</p></td>
<td><p>-3%</p></td>
<td><p>+2%</p></td>
</tr>
<tr class="row-odd"><td><p><strong>12</strong></p></td>
<td><p><strong>5</strong></p></td>
<td><p><strong>64 KiB</strong></p></td>
<td><p><strong>=</strong></p></td>
<td><p><strong>=</strong></p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>4</p></td>
<td><p>46 KiB</p></td>
<td><p>+10%</p></td>
<td><p>+4%</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>3</p></td>
<td><p>37 KiB</p></td>
<td><p>+70%</p></td>
<td><p>+40%</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>2</p></td>
<td><p>33 KiB</p></td>
<td><p>+130%</p></td>
<td><p>+90%</p></td>
</tr>
<tr class="row-odd"><td><p>—</p></td>
<td><p>—</p></td>
<td><p>14 KiB</p></td>
<td><p>+350%</p></td>
<td><p>—</p></td>
</tr>
</tbody>
</table>
</div>
<p>Window Bits and Memory Level don’t have to move in lockstep. However, other
combinations don’t yield significantly better results than those shown above.</p>
<p>websockets defaults to Window Bits = 12 and Memory Level = 5 to stay away from
Window Bits = 10 or Memory Level = 3 where performance craters, raising doubts
on what could happen at Window Bits = 11 and Memory Level = 4 on a different
corpus.</p>
<p>Defaults must be safe for all applications, hence a more conservative choice.</p>
</section>
<section id="optimizing-settings">
<h2>Optimizing settings<a class="headerlink" href="compression.html#optimizing-settings" title="Link to this heading">¶</a></h2>
<p>Compressed size and compression time depend on the structure of messages
exchanged by your application. As a consequence, default settings may not be
optimal for your use case.</p>
<p>To compare how various compression settings perform for your use case:</p>
<ol class="arabic simple">
<li><p>Create a corpus of typical messages in a directory, one message per file.</p></li>
<li><p>Run the <a class="reference external" href="https://github.com/python-websockets/websockets/blob/main/experiments/compression/benchmark.py">compression/benchmark.py</a> script, passing the directory in
argument.</p></li>
</ol>
<p>The script measures compressed size and compression time for all combinations of
Window Bits and Memory Level. It outputs two tables with absolute values and two
tables with values relative to websockets’ default settings.</p>
<p>Pick your favorite settings in these tables and configure them as shown above.</p>
</section>
<section id="default-settings-for-clients">
<h2>Default settings for clients<a class="headerlink" href="compression.html#default-settings-for-clients" title="Link to this heading">¶</a></h2>
<p>By default, websockets enables compression with Memory Level = 5 but leaves
the Window Bits setting up to the server.</p>
<p>There’s two good reasons and one bad reason for not optimizing Window Bits on
the client side as on the server side:</p>
<ol class="arabic">
<li><p>If the maintainers of a server configured some optimized settings, we don’t
want to override them with more restrictive settings.</p></li>
<li><p>Optimizing memory usage doesn’t matter very much for clients because it’s
uncommon to open thousands of client connections in a program.</p></li>
<li><p>On a more pragmatic and annoying note, some servers misbehave badly when a
client configures compression settings. <a class="reference external" href="https://github.com/python-websockets/websockets/issues/1065">AWS API Gateway</a> is the worst
offender.</p>
<p>Unfortunately, even though websockets is right and AWS is wrong, many users
jump to the conclusion that websockets doesn’t work.</p>
<p>Until the ecosystem levels up, interoperability with buggy servers seems
more valuable than optimizing memory usage.</p>
</li>
</ol>
</section>
<section id="decompression">
<h2>Decompression<a class="headerlink" href="compression.html#decompression" title="Link to this heading">¶</a></h2>
<p>The discussion above focuses on compression because it’s more expensive than
decompression. Indeed, leaving aside small allocations, theoretical memory
usage is:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">(1</span> <span class="pre">&lt;&lt;</span> <span class="pre">(windowBits</span> <span class="pre">+</span> <span class="pre">2))</span> <span class="pre">+</span> <span class="pre">(1</span> <span class="pre">&lt;&lt;</span> <span class="pre">(memLevel</span> <span class="pre">+</span> <span class="pre">9))</span></code> for compression;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;&lt;</span> <span class="pre">windowBits</span></code> for decompression.</p></li>
</ul>
<p>CPU usage is also higher for compression than decompression.</p>
<p>While it’s always possible for a server to use a smaller window size for
compressing outgoing messages, using a smaller window size for decompressing
incoming messages requires collaboration from clients.</p>
<p>When a client doesn’t support configuring the size of its compression window,
websockets enables compression with the largest possible decompression window.
In most use cases, this is more efficient than disabling compression both ways.</p>
<p>If you are very sensitive to memory usage, you can reverse this behavior by
setting the <code class="docutils literal notranslate"><span class="pre">require_client_max_window_bits</span></code> parameter of
<a class="reference internal" href="../reference/extensions.html#websockets.extensions.permessage_deflate.ServerPerMessageDeflateFactory" title="websockets.extensions.permessage_deflate.ServerPerMessageDeflateFactory"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerPerMessageDeflateFactory</span></code></a> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="compression.html#further-reading" title="Link to this heading">¶</a></h2>
<p>This <a class="reference external" href="https://www.igvita.com/2013/11/27/configuring-and-optimizing-websocket-compression/">blog post by Ilya Grigorik</a> provides more details about how compression
settings affect memory usage and how to optimize them.</p>
<p>This <a class="reference external" href="https://mailarchive.ietf.org/arch/msg/hybi/F9t4uPufVEy8KBLuL36cZjCmM_Y/">experiment by Peter Thorson</a> recommends Window Bits = 11 and Memory
Level = 4 for optimizing memory usage.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="keepalive.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Keepalive and latency</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="broadcast.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Broadcasting</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2013-2024, Aymeric Augustin and contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="compression.html#">Compression</a><ul>
<li><a class="reference internal" href="compression.html#configuring-compression">Configuring compression</a></li>
<li><a class="reference internal" href="compression.html#compression-parameters">Compression parameters</a></li>
<li><a class="reference internal" href="compression.html#default-settings-for-servers">Default settings for servers</a></li>
<li><a class="reference internal" href="compression.html#optimizing-settings">Optimizing settings</a></li>
<li><a class="reference internal" href="compression.html#default-settings-for-clients">Default settings for clients</a></li>
<li><a class="reference internal" href="compression.html#decompression">Decompression</a></li>
<li><a class="reference internal" href="compression.html#further-reading">Further reading</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js%3Fv=03fa008d"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/scripts/furo.js%3Fv=5fa4622c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/tabs.js%3Fv=3ee01567"></script>
    </body>
</html>