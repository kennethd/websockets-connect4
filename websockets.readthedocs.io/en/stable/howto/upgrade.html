<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Upgrade to the new asyncio implementation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="howto/upgrade.html" />
<meta property="og:site_name" content="websockets" />
<meta property="og:description" content="The new asyncio implementation, which is now the default, is a rewrite of the original implementation of websockets. It provides a very similar API. However, there are a few differences. The recomm..." />
<meta name="description" content="The new asyncio implementation, which is now the default, is a rewrite of the original implementation of websockets. It provides a very similar API. However, there are a few differences. The recomm..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Cheat sheet" href="cheatsheet.html" /><link rel="prev" title="Quick start" href="quickstart.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Upgrade to the new asyncio implementation - websockets 14.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=a746c00c.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css%3Fv=354aac6f.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css%3Fv=4c969af8.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css%3Fv=302659d7.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #306998;
  --color-brand-content: #0b487a;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
      }
    }
  }
</style><script async type="text/javascript" src="../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="websockets" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/howto/upgrade.html" /><meta name="readthedocs-http-status" content="200" /></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="upgrade.html#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">websockets 14.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/websockets.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial1.html">Part 1 - Send &amp; receive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial2.html">Part 2 - Route &amp; broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial3.html">Part 3 - Deploy to the web</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How-to guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="upgrade.html#">Upgrade to the new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code> implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheatsheet.html">Cheat sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="autoreload.html">Reload on code changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="django.html">Integrate with Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Write an extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="render.html">Deploy to Render</a></li>
<li class="toctree-l2"><a class="reference internal" href="fly.html">Deploy to Fly</a></li>
<li class="toctree-l2"><a class="reference internal" href="heroku.html">Deploy to Heroku</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Deploy to Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="supervisor.html">Deploy with Supervisor</a></li>
<li class="toctree-l2"><a class="reference internal" href="nginx.html">Deploy behind nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="haproxy.html">Deploy behind HAProxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="sansio.html">Integrate the Sans-I/O layer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">Frequently asked questions</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Frequently asked questions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/server.html">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/common.html">Both sides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/asyncio.html">Using asyncio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/features.html">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/server.html">Server (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/client.html">Client (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/server.html">Server (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/client.html">Client (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/server.html">Server (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/client.html">Client (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/server.html">Server (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/client.html">Client (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/extensions.html">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/datastructures.html">Data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/variables.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../topics/index.html">Topic guides</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Topic guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../topics/deployment.html">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/broadcast.html">Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/compression.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/keepalive.html">Keepalive and latency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/memory.html">Memory and buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/performance.html">Performance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../project/index.html">About websockets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of About websockets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../project/changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/sponsoring.html">Sponsoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/tidelift.html">For enterprise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/support.html">Getting support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/license.html">License</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="upgrade.html#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="upgrade-to-the-new-asyncio-implementation">
<h1>Upgrade to the new <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation<a class="headerlink" href="upgrade.html#upgrade-to-the-new-asyncio-implementation" title="Link to this heading">¶</a></h1>
<p>The new <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation, which is now the default, is a rewrite of
the original implementation of websockets.</p>
<p>It provides a very similar API. However, there are a few differences.</p>
<p>The recommended upgrade process is:</p>
<ol class="arabic simple">
<li><p>Make sure that your code doesn’t use any <a class="reference internal" href="upgrade.html#deprecated-apis">deprecated APIs</a>. If it doesn’t
raise warnings, you’re fine.</p></li>
<li><p><a class="reference internal" href="upgrade.html#update-import-paths">Update import paths</a>. For straightforward use cases, this could be the only
step you need to take.</p></li>
<li><p>Check out <a class="reference internal" href="upgrade.html#new-features-and-improvements">new features and improvements</a>. Consider taking advantage of them
in your code.</p></li>
<li><p>Review <a class="reference internal" href="upgrade.html#api-changes">API changes</a>. If needed, update your application to preserve its
current behavior.</p></li>
</ol>
<p>In the interest of brevity, only <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> are discussed below but everything also applies
to <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.unix_connect" title="websockets.asyncio.client.unix_connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">unix_connect()</span></code></a> and <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.unix_serve" title="websockets.asyncio.server.unix_serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">unix_serve()</span></code></a>
respectively.</p>
<div class="hint admonition">
<p class="admonition-title">What will happen to the original implementation?</p>
<p>The original implementation is deprecated. It will be maintained for five
years after deprecation according to the <a class="reference internal" href="../project/changelog.html#backwards-compatibility-policy"><span class="std std-ref">backwards-compatibility
policy</span></a>. Then, by 2030, it will be removed.</p>
</div>
<section id="deprecated-apis">
<span id="id1"></span><h2>Deprecated APIs<a class="headerlink" href="upgrade.html#deprecated-apis" title="Link to this heading">¶</a></h2>
<p>Here’s the list of deprecated behaviors that the original implementation still
supports and that the new implementation doesn’t reproduce.</p>
<p>If you’re seeing a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#DeprecationWarning" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DeprecationWarning</span></code></a>, follow upgrade instructions from
the release notes of the version in which the feature was deprecated.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">path</span></code> argument of connection handlers — unnecessary since <a class="reference internal" href="../project/changelog.html#id49"><span class="std std-ref">10.1</span></a>
and deprecated in <a class="reference internal" href="../project/changelog.html#id16"><span class="std std-ref">13.0</span></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">loop</span></code> and <code class="docutils literal notranslate"><span class="pre">legacy_recv</span></code> arguments of <a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.connect" title="websockets.legacy.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a>
and <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a>, which were removed — deprecated in
<a class="reference internal" href="../project/changelog.html#id54"><span class="std std-ref">10.0</span></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">klass</span></code> arguments of <a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.connect" title="websockets.legacy.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a>, which were renamed to <code class="docutils literal notranslate"><span class="pre">close_timeout</span></code> and
<code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> — deprecated in <a class="reference internal" href="../project/changelog.html#id86"><span class="std std-ref">7.0</span></a> and <a class="reference internal" href="../project/changelog.html#id113"><span class="std std-ref">3.4</span></a> respectively.</p></li>
<li><p>An empty string in the <code class="docutils literal notranslate"><span class="pre">origins</span></code> argument of <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> —
deprecated in <a class="reference internal" href="../project/changelog.html#id86"><span class="std std-ref">7.0</span></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">port</span></code>, and <code class="docutils literal notranslate"><span class="pre">secure</span></code> attributes of connections — deprecated
in <a class="reference internal" href="../project/changelog.html#id80"><span class="std std-ref">8.0</span></a>.</p></li>
</ul>
</section>
<section id="import-paths">
<span id="update-import-paths"></span><h2>Import paths<a class="headerlink" href="upgrade.html#import-paths" title="Link to this heading">¶</a></h2>
<p>For context, the <code class="docutils literal notranslate"><span class="pre">websockets</span></code> package is structured as follows:</p>
<ul class="simple">
<li><p>The new implementation is found in the <code class="docutils literal notranslate"><span class="pre">websockets.asyncio</span></code> package.</p></li>
<li><p>The original implementation was moved to the <code class="docutils literal notranslate"><span class="pre">websockets.legacy</span></code> package
and deprecated.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">websockets</span></code> package provides aliases for convenience. They were
switched to the new implementation in version 14.0 or deprecated when there
wasn’t an equivalent API.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">websockets.client</span></code> and <code class="docutils literal notranslate"><span class="pre">websockets.server</span></code> packages provide aliases
for backwards-compatibility with earlier versions of websockets. They were
deprecated.</p></li>
</ul>
<p>To upgrade to the new <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation, change import paths as
shown in the tables below.</p>
<section id="client-apis">
<h3>Client APIs<a class="headerlink" href="upgrade.html#client-apis" title="Link to this heading">¶</a></h3>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Legacy <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
<th class="head"><p>New <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.connect()</span></code> <em>(before 14.0)</em>                     <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.client.connect()</span></code>                              <br/>
<a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.connect" title="websockets.legacy.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.client.connect()</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">websockets.connect()</span></code> <em>(since 14.0)</em>        <br/>
<a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.client.connect()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.unix_connect()</span></code> <em>(before 14.0)</em>                <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.client.unix_connect()</span></code>                         <br/>
<a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.unix_connect" title="websockets.legacy.client.unix_connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.client.unix_connect()</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">websockets.unix_connect()</span></code> <em>(since 14.0)</em>   <br/>
<a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.unix_connect" title="websockets.asyncio.client.unix_connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.client.unix_connect()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.WebSocketClientProtocol</span></code>                       <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.client.WebSocketClientProtocol</span></code>                <br/>
<a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.WebSocketClientProtocol" title="websockets.legacy.client.WebSocketClientProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.legacy.client.WebSocketClientProtocol</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.ClientConnection" title="websockets.asyncio.client.ClientConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.asyncio.client.ClientConnection</span></code></a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="server-apis">
<h3>Server APIs<a class="headerlink" href="upgrade.html#server-apis" title="Link to this heading">¶</a></h3>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Legacy <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
<th class="head"><p>New <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.serve()</span></code> <em>(before 14.0)</em>                       <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.server.serve()</span></code>                                <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.server.serve()</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">websockets.serve()</span></code> <em>(since 14.0)</em>          <br/>
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.server.serve()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.unix_serve()</span></code> <em>(before 14.0)</em>                  <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.server.unix_serve()</span></code>                           <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.unix_serve" title="websockets.legacy.server.unix_serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.server.unix_serve()</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">websockets.unix_serve()</span></code> <em>(since 14.0)</em>     <br/>
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.unix_serve" title="websockets.asyncio.server.unix_serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.server.unix_serve()</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.WebSocketServer</span></code>                               <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.server.WebSocketServer</span></code>                        <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServer" title="websockets.legacy.server.WebSocketServer"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.legacy.server.WebSocketServer</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.Server" title="websockets.asyncio.server.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.asyncio.server.Server</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.WebSocketServerProtocol</span></code>                       <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.server.WebSocketServerProtocol</span></code>                <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServerProtocol" title="websockets.legacy.server.WebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.legacy.server.WebSocketServerProtocol</span></code></a></p></td>
<td><p><a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.ServerConnection" title="websockets.asyncio.server.ServerConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.asyncio.server.ServerConnection</span></code></a></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.broadcast()</span></code> <em>(before 14.0)</em>                   <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.broadcast" title="websockets.legacy.server.broadcast"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.server.broadcast()</span></code></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">websockets.broadcast()</span></code> <em>(since 14.0)</em>      <br/>
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.broadcast" title="websockets.asyncio.server.broadcast"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.server.broadcast()</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.BasicAuthWebSocketServerProtocol</span></code>              <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.auth.BasicAuthWebSocketServerProtocol</span></code>         <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.BasicAuthWebSocketServerProtocol" title="websockets.legacy.auth.BasicAuthWebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">websockets.legacy.auth.BasicAuthWebSocketServerProtocol</span></code></a></p></td>
<td><p>See below <a class="reference internal" href="upgrade.html#basic-auth"><span class="std std-ref">how to migrate</span></a> to
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.basic_auth" title="websockets.asyncio.server.basic_auth"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.server.basic_auth()</span></code></a>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">websockets.basic_auth_protocol_factory()</span></code>                 <br/>
<code class="docutils literal notranslate"><span class="pre">websockets.auth.basic_auth_protocol_factory()</span></code>            <br/>
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.basic_auth_protocol_factory" title="websockets.legacy.auth.basic_auth_protocol_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.legacy.auth.basic_auth_protocol_factory()</span></code></a></p></td>
<td><p>See below <a class="reference internal" href="upgrade.html#basic-auth"><span class="std std-ref">how to migrate</span></a> to
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.basic_auth" title="websockets.asyncio.server.basic_auth"><code class="xref py py-func docutils literal notranslate"><span class="pre">websockets.asyncio.server.basic_auth()</span></code></a>.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="new-features-and-improvements">
<span id="id2"></span><h2>New features and improvements<a class="headerlink" href="upgrade.html#new-features-and-improvements" title="Link to this heading">¶</a></h2>
<section id="customizing-the-opening-handshake">
<h3>Customizing the opening handshake<a class="headerlink" href="upgrade.html#customizing-the-opening-handshake" title="Link to this heading">¶</a></h3>
<p>On the server side, if you’re customizing how <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a>
processes the opening handshake with <code class="docutils literal notranslate"><span class="pre">process_request</span></code>, <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code>, or
<code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code>, you must update your code. Probably you can simplify it!</p>
<p><code class="docutils literal notranslate"><span class="pre">process_request</span></code> and <code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code> have new signatures.
<code class="docutils literal notranslate"><span class="pre">process_response</span></code> replaces <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> and provides more flexibility.
See <a class="reference internal" href="upgrade.html#process-request">process_request</a>, <a class="reference internal" href="upgrade.html#select-subprotocol">select_subprotocol</a>, and <a class="reference internal" href="upgrade.html#process-response">process_response</a> below.</p>
</section>
<section id="customizing-automatic-reconnection">
<h3>Customizing automatic reconnection<a class="headerlink" href="upgrade.html#customizing-automatic-reconnection" title="Link to this heading">¶</a></h3>
<p>On the client side, if you’re reconnecting automatically with <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">for</span> <span class="pre">...</span> <span class="pre">in</span>
<span class="pre">connect(...)</span></code>, the behavior when a connection attempt fails was enhanced and
made configurable.</p>
<p>The original implementation retried on any error. The new implementation uses an
heuristic to determine whether an error is retryable or fatal. By default, only
network errors and server errors (HTTP 500, 502, 503, or 504) are considered
retryable. You can customize this behavior with the <code class="docutils literal notranslate"><span class="pre">process_exception</span></code>
argument of <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a>.</p>
<p>See <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.process_exception" title="websockets.asyncio.client.process_exception"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_exception()</span></code></a> for more information.</p>
<p>Here’s how to revert to the behavior of the original implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">for</span> <span class="o">...</span> <span class="ow">in</span> <span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">process_exception</span><span class="o">=</span><span class="k">lambda</span> <span class="n">exc</span><span class="p">:</span> <span class="n">exc</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="tracking-open-connections">
<h3>Tracking open connections<a class="headerlink" href="upgrade.html#tracking-open-connections" title="Link to this heading">¶</a></h3>
<p>The new implementation of <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.Server" title="websockets.asyncio.server.Server"><code class="xref py py-class docutils literal notranslate"><span class="pre">Server</span></code></a> provides a
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.Server.connections" title="websockets.asyncio.server.Server.connections"><code class="xref py py-attr docutils literal notranslate"><span class="pre">connections</span></code></a> property, which is a set of all open
connections. This didn’t exist in the original implementation.</p>
<p>If you’re keeping track of open connections in order to broadcast messages to
all of them, you can simplify your code by using this property.</p>
</section>
<section id="controlling-utf-8-decoding">
<h3>Controlling UTF-8 decoding<a class="headerlink" href="upgrade.html#controlling-utf-8-decoding" title="Link to this heading">¶</a></h3>
<p>The new implementation of the <a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv" title="websockets.asyncio.connection.Connection.recv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv()</span></code></a> method
provides the <code class="docutils literal notranslate"><span class="pre">decode</span></code> argument to control UTF-8 decoding of messages. This
didn’t exist in the original implementation.</p>
<p>If you’re calling <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.encode" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code></a> on a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> object returned by
<a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv" title="websockets.asyncio.connection.Connection.recv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv()</span></code></a>, using <code class="docutils literal notranslate"><span class="pre">decode=False</span></code> and removing
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.encode" title="(in Python v3.13)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">encode()</span></code></a> saves a round-trip of UTF-8 decoding and encoding for text
messages.</p>
<p>You can also force UTF-8 decoding of binary messages with <code class="docutils literal notranslate"><span class="pre">decode=True</span></code>. This
is rarely useful and has no performance benefits over decoding a <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes</span></code></a>
object returned by <a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv" title="websockets.asyncio.connection.Connection.recv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv()</span></code></a>.</p>
</section>
<section id="receiving-fragmented-messages">
<h3>Receiving fragmented messages<a class="headerlink" href="upgrade.html#receiving-fragmented-messages" title="Link to this heading">¶</a></h3>
<p>The new implementation provides the
<a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv_streaming" title="websockets.asyncio.connection.Connection.recv_streaming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv_streaming()</span></code></a> method for receiving a
fragmented message frame by frame. There was no way to do this in the original
implementation.</p>
<p>Depending on your use case, adopting this method may improve performance when
streaming large messages. Specifically, it could reduce memory usage.</p>
</section>
</section>
<section id="api-changes">
<span id="id3"></span><h2>API changes<a class="headerlink" href="upgrade.html#api-changes" title="Link to this heading">¶</a></h2>
<section id="attributes-of-connection-objects">
<h3>Attributes of connection objects<a class="headerlink" href="upgrade.html#attributes-of-connection-objects" title="Link to this heading">¶</a></h3>
<section id="path-request-headers-and-response-headers">
<h4><code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">request_headers</span></code>, and <code class="docutils literal notranslate"><span class="pre">response_headers</span></code><a class="headerlink" href="upgrade.html#path-request-headers-and-response-headers" title="Link to this heading">¶</a></h4>
<p>The <a class="reference internal" href="../reference/legacy/common.html#websockets.legacy.protocol.WebSocketCommonProtocol.path" title="websockets.legacy.protocol.WebSocketCommonProtocol.path"><code class="xref py py-attr docutils literal notranslate"><span class="pre">path</span></code></a>,
<a class="reference internal" href="../reference/legacy/common.html#websockets.legacy.protocol.WebSocketCommonProtocol.request_headers" title="websockets.legacy.protocol.WebSocketCommonProtocol.request_headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request_headers</span></code></a> and
<a class="reference internal" href="../reference/legacy/common.html#websockets.legacy.protocol.WebSocketCommonProtocol.response_headers" title="websockets.legacy.protocol.WebSocketCommonProtocol.response_headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response_headers</span></code></a> properties are
replaced by <a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.request" title="websockets.asyncio.connection.Connection.request"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request</span></code></a> and
<a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.response" title="websockets.asyncio.connection.Connection.response"><code class="xref py py-attr docutils literal notranslate"><span class="pre">response</span></code></a>.</p>
<p>If your code uses them, you can update it as follows.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Legacy <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
<th class="head"><p>New <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">connection.path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">connection.request.path</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">connection.request_headers</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">connection.request.headers</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">connection.response_headers</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">connection.response.headers</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="open-and-closed">
<h4><code class="docutils literal notranslate"><span class="pre">open</span></code> and <code class="docutils literal notranslate"><span class="pre">closed</span></code><a class="headerlink" href="upgrade.html#open-and-closed" title="Link to this heading">¶</a></h4>
<p>The <a class="reference internal" href="../reference/legacy/common.html#websockets.legacy.protocol.WebSocketCommonProtocol.open" title="websockets.legacy.protocol.WebSocketCommonProtocol.open"><code class="xref py py-attr docutils literal notranslate"><span class="pre">open</span></code></a> and
<a class="reference internal" href="../reference/legacy/common.html#websockets.legacy.protocol.WebSocketCommonProtocol.closed" title="websockets.legacy.protocol.WebSocketCommonProtocol.closed"><code class="xref py py-attr docutils literal notranslate"><span class="pre">closed</span></code></a> properties are removed.
Using them was discouraged.</p>
<p>Instead, you should call <a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv" title="websockets.asyncio.connection.Connection.recv"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv()</span></code></a> or
<a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.send" title="websockets.asyncio.connection.Connection.send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> and handle
<a class="reference internal" href="../reference/exceptions.html#websockets.exceptions.ConnectionClosed" title="websockets.exceptions.ConnectionClosed"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionClosed</span></code></a> exceptions.</p>
<p>If your code uses them, you can update it as follows.</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Legacy <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
<th class="head"><p>New <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.13)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">websockets.protocol</span> <span class="pre">import</span> <span class="pre">State</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">connection.open</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">connection.state</span> <span class="pre">is</span> <span class="pre">State.OPEN</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">connection.closed</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">connection.state</span> <span class="pre">is</span> <span class="pre">State.CLOSED</span></code></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="arguments-of-connect">
<h3>Arguments of <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a><a class="headerlink" href="upgrade.html#arguments-of-connect" title="Link to this heading">¶</a></h3>
<section id="extra-headers-additional-headers">
<h4><code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> → <code class="docutils literal notranslate"><span class="pre">additional_headers</span></code><a class="headerlink" href="upgrade.html#extra-headers-additional-headers" title="Link to this heading">¶</a></h4>
<p>If you’re adding headers to the handshake request sent by
<a class="reference internal" href="../reference/legacy/client.html#websockets.legacy.client.connect" title="websockets.legacy.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> with the <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> argument, you must
rename it to <code class="docutils literal notranslate"><span class="pre">additional_headers</span></code>.</p>
</section>
</section>
<section id="arguments-of-serve">
<h3>Arguments of <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a><a class="headerlink" href="upgrade.html#arguments-of-serve" title="Link to this heading">¶</a></h3>
<section id="ws-handler-handler">
<h4><code class="docutils literal notranslate"><span class="pre">ws_handler</span></code> → <code class="docutils literal notranslate"><span class="pre">handler</span></code><a class="headerlink" href="upgrade.html#ws-handler-handler" title="Link to this heading">¶</a></h4>
<p>The first argument of <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> is now called <code class="docutils literal notranslate"><span class="pre">handler</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">ws_handler</span></code>. It’s usually passed as a positional argument, making
this change transparent. If you’re passing it as a keyword argument, you must
update its name.</p>
</section>
<section id="process-request">
<span id="id4"></span><h4><code class="docutils literal notranslate"><span class="pre">process_request</span></code><a class="headerlink" href="upgrade.html#process-request" title="Link to this heading">¶</a></h4>
<p>The signature of <code class="docutils literal notranslate"><span class="pre">process_request</span></code> changed. This is easiest to illustrate with
an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">http</span>

<span class="c1"># Original implementation</span>

<span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">request_headers</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span> <span class="p">[],</span> <span class="sa">b</span><span class="s2">&quot;OK</span><span class="se">\n</span><span class="s2">&quot;</span>

<span class="c1"># New implementation</span>

<span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">connection</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="p">,</span> <span class="s2">&quot;OK</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">process_request</span><span class="o">=</span><span class="n">process_request</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">connection</span></code> is always available in <code class="docutils literal notranslate"><span class="pre">process_request</span></code>. In the original
implementation, if you wanted to make the connection object available in a
<code class="docutils literal notranslate"><span class="pre">process_request</span></code> method, you had to write a subclass of
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServerProtocol" title="websockets.legacy.server.WebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketServerProtocol</span></code></a> and pass it in the
<code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> argument. This pattern isn’t useful anymore; you can
replace it with a <code class="docutils literal notranslate"><span class="pre">process_request</span></code> function or coroutine.</p>
<p><code class="docutils literal notranslate"><span class="pre">path</span></code> and <code class="docutils literal notranslate"><span class="pre">headers</span></code> are available as attributes of the <code class="docutils literal notranslate"><span class="pre">request</span></code> object.</p>
</section>
<section id="extra-headers-process-response">
<span id="process-response"></span><h4><code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> → <code class="docutils literal notranslate"><span class="pre">process_response</span></code><a class="headerlink" href="upgrade.html#extra-headers-process-response" title="Link to this heading">¶</a></h4>
<p>If you’re adding headers to the handshake response sent by
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> with the <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> argument, you must write
a <code class="docutils literal notranslate"><span class="pre">process_response</span></code> callable instead.</p>
<p><code class="docutils literal notranslate"><span class="pre">process_request</span></code> replaces <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> and provides more flexibility.
In the most basic case, you would adapt your code as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original implementation</span>

<span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">extra_headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c1"># New implementation</span>

<span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">HEADERS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>

<span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">process_response</span><span class="o">=</span><span class="n">process_response</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">connection</span></code> is always available in <code class="docutils literal notranslate"><span class="pre">process_response</span></code>, similar to
<code class="docutils literal notranslate"><span class="pre">process_request</span></code>. In the original implementation, there was no way to make
the connection object available.</p>
<p>In addition, the <code class="docutils literal notranslate"><span class="pre">request</span></code> and <code class="docutils literal notranslate"><span class="pre">response</span></code> objects are available, which
enables a broader range of use cases (e.g., logging) and makes
<code class="docutils literal notranslate"><span class="pre">process_response</span></code> more useful than <code class="docutils literal notranslate"><span class="pre">extra_headers</span></code>.</p>
</section>
<section id="select-subprotocol">
<span id="id5"></span><h4><code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code><a class="headerlink" href="upgrade.html#select-subprotocol" title="Link to this heading">¶</a></h4>
<p>If you’re selecting a subprotocol, you must update your code because the
signature of <code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code> changed. Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Original implementation</span>

<span class="k">def</span> <span class="nf">select_subprotocol</span><span class="p">(</span><span class="n">client_subprotocols</span><span class="p">,</span> <span class="n">server_subprotocols</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;chat&quot;</span> <span class="ow">in</span> <span class="n">client_subprotocols</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;chat&quot;</span>

<span class="c1"># New implementation</span>

<span class="k">def</span> <span class="nf">select_subprotocol</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">subprotocols</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;chat&quot;</span> <span class="ow">in</span> <span class="n">subprotocols</span>
        <span class="k">return</span> <span class="s2">&quot;chat&quot;</span>

<span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">select_subprotocol</span><span class="o">=</span><span class="n">select_subprotocol</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">connection</span></code> is always available in <code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code>. This brings the
same benefits as in <code class="docutils literal notranslate"><span class="pre">process_request</span></code>. It may remove the need to subclass
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServerProtocol" title="websockets.legacy.server.WebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketServerProtocol</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">subprotocols</span></code> argument contains the list of subprotocols offered by the
client. The list of subprotocols supported by the server was removed because
<code class="docutils literal notranslate"><span class="pre">select_subprotocols</span></code> has to know which subprotocols it may select and under
which conditions.</p>
<p>Furthermore, the default behavior when <code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code> isn’t provided
changed in two ways:</p>
<ol class="arabic simple">
<li><p>In the original implementation, a server with a list of subprotocols accepted
to continue without a subprotocol. In the new implementation, a server that
is configured with subprotocols rejects connections that don’t support any.</p></li>
<li><p>In the original implementation, when several subprotocols were available, the
server averaged the client’s preferences with its own preferences. In the new
implementation, the server just picks the first subprotocol from its list.</p></li>
</ol>
<p>If you had a <code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code> for the sole purpose of rejecting
connections without a subprotocol, you can remove it and keep only the
<code class="docutils literal notranslate"><span class="pre">subprotocols</span></code> argument.</p>
</section>
</section>
<section id="arguments-of-connect-and-serve">
<h3>Arguments of <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a><a class="headerlink" href="upgrade.html#arguments-of-connect-and-serve" title="Link to this heading">¶</a></h3>
<section id="max-queue">
<h4><code class="docutils literal notranslate"><span class="pre">max_queue</span></code><a class="headerlink" href="upgrade.html#max-queue" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">max_queue</span></code> argument of <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> has a new meaning but achieves a similar effect.</p>
<p>It is now the high-water mark of a buffer of incoming frames. It defaults to 16
frames. It used to be the size of a buffer of incoming messages that refilled as
soon as a message was read. It used to default to 32 messages.</p>
<p>This can make a difference when messages are fragmented in several frames. In
that case, you may want to increase <code class="docutils literal notranslate"><span class="pre">max_queue</span></code>.</p>
<p>If you’re writing a high performance server and you know that you’re receiving
fragmented messages, probably you should adopt
<a class="reference internal" href="../reference/asyncio/common.html#websockets.asyncio.connection.Connection.recv_streaming" title="websockets.asyncio.connection.Connection.recv_streaming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">recv_streaming()</span></code></a> and optimize the
performance of reads again.</p>
<p>In all other cases, given how uncommon fragmentation is, you shouldn’t worry
about this change.</p>
</section>
<section id="read-limit">
<h4><code class="docutils literal notranslate"><span class="pre">read_limit</span></code><a class="headerlink" href="upgrade.html#read-limit" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">read_limit</span></code> argument doesn’t exist in the new implementation because it
doesn’t buffer data received from the network in a
<a class="reference external" href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StreamReader</span></code></a>. With a better design, this buffer could be
removed.</p>
<p>The buffer of incoming frames configured by <code class="docutils literal notranslate"><span class="pre">max_queue</span></code> is the only read
buffer now.</p>
</section>
<section id="write-limit">
<h4><code class="docutils literal notranslate"><span class="pre">write_limit</span></code><a class="headerlink" href="upgrade.html#write-limit" title="Link to this heading">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">write_limit</span></code> argument of <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> and
<a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> defaults to 32 KiB instead of 64 KiB.</p>
</section>
<section id="create-protocol-create-connection">
<h4><code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> → <code class="docutils literal notranslate"><span class="pre">create_connection</span></code><a class="headerlink" href="upgrade.html#create-protocol-create-connection" title="Link to this heading">¶</a></h4>
<p>The keyword argument of <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.serve" title="websockets.asyncio.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> for customizing the
creation of the connection object is now called <code class="docutils literal notranslate"><span class="pre">create_connection</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">create_protocol</span></code>. It must return a <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.ServerConnection" title="websockets.asyncio.server.ServerConnection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerConnection</span></code></a>
instead of a <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServerProtocol" title="websockets.legacy.server.WebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketServerProtocol</span></code></a>.</p>
<p>If you were customizing connection objects, probably you need to redo your
customization. Consider switching to <code class="docutils literal notranslate"><span class="pre">process_request</span></code> and
<code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code> as their new design removes most use cases for
<code class="docutils literal notranslate"><span class="pre">create_connection</span></code>.</p>
</section>
</section>
<section id="performing-http-basic-authentication">
<span id="basic-auth"></span><h3>Performing HTTP Basic Authentication<a class="headerlink" href="upgrade.html#performing-http-basic-authentication" title="Link to this heading">¶</a></h3>
<div class="tip admonition">
<p class="admonition-title">This section applies only to servers.</p>
<p>On the client side, <a class="reference internal" href="../reference/asyncio/client.html#websockets.asyncio.client.connect" title="websockets.asyncio.client.connect"><code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a> performs HTTP Basic
Authentication automatically when the URI contains credentials.</p>
</div>
<p>In the original implementation, the recommended way to add HTTP Basic
Authentication to a server was to set the <code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> argument of
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a> to a factory function generated by
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.basic_auth_protocol_factory" title="websockets.legacy.auth.basic_auth_protocol_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">basic_auth_protocol_factory()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.legacy.auth</span> <span class="kn">import</span> <span class="n">basic_auth_protocol_factory</span>
<span class="kn">from</span> <span class="nn">websockets.legacy.server</span> <span class="kn">import</span> <span class="n">serve</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">create_protocol</span><span class="o">=</span><span class="n">basic_auth_protocol_factory</span><span class="p">(</span><span class="o">...</span><span class="p">)):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>In the new implementation, the <a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.basic_auth" title="websockets.asyncio.server.basic_auth"><code class="xref py py-func docutils literal notranslate"><span class="pre">basic_auth()</span></code></a> function
generates a <code class="docutils literal notranslate"><span class="pre">process_request</span></code> coroutine that performs HTTP Basic
Authentication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.asyncio.server</span> <span class="kn">import</span> <span class="n">basic_auth</span><span class="p">,</span> <span class="n">serve</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">process_request</span><span class="o">=</span><span class="n">basic_auth</span><span class="p">(</span><span class="o">...</span><span class="p">)):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="../reference/asyncio/server.html#websockets.asyncio.server.basic_auth" title="websockets.asyncio.server.basic_auth"><code class="xref py py-func docutils literal notranslate"><span class="pre">basic_auth()</span></code></a> accepts either hard coded <code class="docutils literal notranslate"><span class="pre">credentials</span></code> or
a <code class="docutils literal notranslate"><span class="pre">check_credentials</span></code> coroutine as well as an optional <code class="docutils literal notranslate"><span class="pre">realm</span></code> just like
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.basic_auth_protocol_factory" title="websockets.legacy.auth.basic_auth_protocol_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">basic_auth_protocol_factory()</span></code></a>. Furthermore,
<code class="docutils literal notranslate"><span class="pre">check_credentials</span></code> may be a function instead of a coroutine.</p>
<p>This new API has more obvious semantics. That makes it easier to understand and
also easier to extend.</p>
<p>In the original implementation, overriding <code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> changes the type
of connection objects to <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.BasicAuthWebSocketServerProtocol" title="websockets.legacy.auth.BasicAuthWebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicAuthWebSocketServerProtocol</span></code></a>,
a subclass of <a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.WebSocketServerProtocol" title="websockets.legacy.server.WebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">WebSocketServerProtocol</span></code></a> that performs HTTP
Basic Authentication in its <code class="docutils literal notranslate"><span class="pre">process_request</span></code> method.</p>
<p>To customize <code class="docutils literal notranslate"><span class="pre">process_request</span></code> further, you had only bad options:</p>
<ul class="simple">
<li><p>the ill-defined option: add a <code class="docutils literal notranslate"><span class="pre">process_request</span></code> argument to
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.server.serve" title="websockets.legacy.server.serve"><code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a>; to tell which one would run first, you had to
experiment or read the code;</p></li>
<li><p>the cumbersome option: subclass
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.BasicAuthWebSocketServerProtocol" title="websockets.legacy.auth.BasicAuthWebSocketServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicAuthWebSocketServerProtocol</span></code></a>, then pass that
subclass in the <code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> argument of
<a class="reference internal" href="../reference/legacy/server.html#websockets.legacy.auth.basic_auth_protocol_factory" title="websockets.legacy.auth.basic_auth_protocol_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">basic_auth_protocol_factory()</span></code></a>.</p></li>
</ul>
<p>In the new implementation, you just write a <code class="docutils literal notranslate"><span class="pre">process_request</span></code> coroutine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.asyncio.server</span> <span class="kn">import</span> <span class="n">basic_auth</span><span class="p">,</span> <span class="n">serve</span>

<span class="n">process_basic_auth</span> <span class="o">=</span> <span class="n">basic_auth</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>  <span class="c1"># some logic here</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">process_basic_auth</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span>
    <span class="o">...</span> <span class="c1"># more logic here</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">serve</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">process_request</span><span class="o">=</span><span class="n">process_request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cheatsheet.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Cheat sheet</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="quickstart.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Quick start</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2013-2024, Aymeric Augustin and contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="upgrade.html#">Upgrade to the new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code> implementation</a><ul>
<li><a class="reference internal" href="upgrade.html#deprecated-apis">Deprecated APIs</a></li>
<li><a class="reference internal" href="upgrade.html#import-paths">Import paths</a><ul>
<li><a class="reference internal" href="upgrade.html#client-apis">Client APIs</a></li>
<li><a class="reference internal" href="upgrade.html#server-apis">Server APIs</a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#new-features-and-improvements">New features and improvements</a><ul>
<li><a class="reference internal" href="upgrade.html#customizing-the-opening-handshake">Customizing the opening handshake</a></li>
<li><a class="reference internal" href="upgrade.html#customizing-automatic-reconnection">Customizing automatic reconnection</a></li>
<li><a class="reference internal" href="upgrade.html#tracking-open-connections">Tracking open connections</a></li>
<li><a class="reference internal" href="upgrade.html#controlling-utf-8-decoding">Controlling UTF-8 decoding</a></li>
<li><a class="reference internal" href="upgrade.html#receiving-fragmented-messages">Receiving fragmented messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#api-changes">API changes</a><ul>
<li><a class="reference internal" href="upgrade.html#attributes-of-connection-objects">Attributes of connection objects</a><ul>
<li><a class="reference internal" href="upgrade.html#path-request-headers-and-response-headers"><code class="docutils literal notranslate"><span class="pre">path</span></code>, <code class="docutils literal notranslate"><span class="pre">request_headers</span></code>, and <code class="docutils literal notranslate"><span class="pre">response_headers</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#open-and-closed"><code class="docutils literal notranslate"><span class="pre">open</span></code> and <code class="docutils literal notranslate"><span class="pre">closed</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#arguments-of-connect">Arguments of <code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code></a><ul>
<li><a class="reference internal" href="upgrade.html#extra-headers-additional-headers"><code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> → <code class="docutils literal notranslate"><span class="pre">additional_headers</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#arguments-of-serve">Arguments of <code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a><ul>
<li><a class="reference internal" href="upgrade.html#ws-handler-handler"><code class="docutils literal notranslate"><span class="pre">ws_handler</span></code> → <code class="docutils literal notranslate"><span class="pre">handler</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#process-request"><code class="docutils literal notranslate"><span class="pre">process_request</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#extra-headers-process-response"><code class="docutils literal notranslate"><span class="pre">extra_headers</span></code> → <code class="docutils literal notranslate"><span class="pre">process_response</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#select-subprotocol"><code class="docutils literal notranslate"><span class="pre">select_subprotocol</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#arguments-of-connect-and-serve">Arguments of <code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">serve()</span></code></a><ul>
<li><a class="reference internal" href="upgrade.html#max-queue"><code class="docutils literal notranslate"><span class="pre">max_queue</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#read-limit"><code class="docutils literal notranslate"><span class="pre">read_limit</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#write-limit"><code class="docutils literal notranslate"><span class="pre">write_limit</span></code></a></li>
<li><a class="reference internal" href="upgrade.html#create-protocol-create-connection"><code class="docutils literal notranslate"><span class="pre">create_protocol</span></code> → <code class="docutils literal notranslate"><span class="pre">create_connection</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="upgrade.html#performing-http-basic-authentication">Performing HTTP Basic Authentication</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js%3Fv=03fa008d"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/scripts/furo.js%3Fv=5fa4622c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/tabs.js%3Fv=3ee01567"></script>
    </body>
</html>