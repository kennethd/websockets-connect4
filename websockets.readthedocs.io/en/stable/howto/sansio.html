<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Integrate the Sans-I/O layer" />
<meta property="og:type" content="website" />
<meta property="og:url" content="howto/sansio.html" />
<meta property="og:site_name" content="websockets" />
<meta property="og:description" content="This guide explains how to integrate the Sans-I/O layer of websockets to add support for WebSocket in another library. As a prerequisite, you should decide how you will handle network I/O and async..." />
<meta name="description" content="This guide explains how to integrate the Sans-I/O layer of websockets to add support for WebSocket in another library. As a prerequisite, you should decide how you will handle network I/O and async..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Frequently asked questions" href="../faq/index.html" /><link rel="prev" title="Deploy behind HAProxy" href="haproxy.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Integrate the Sans-I/O layer - websockets 14.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=a746c00c.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css%3Fv=354aac6f.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css%3Fv=4c969af8.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css%3Fv=302659d7.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #306998;
  --color-brand-content: #0b487a;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ffd43bcc;
  --color-brand-content: #ffd43bd9;
  
      }
    }
  }
</style><script async type="text/javascript" src="../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="websockets" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/howto/sansio.html" /><meta name="readthedocs-http-status" content="200" /></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="sansio.html#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">websockets 14.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/websockets.svg" alt="Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/index.html">Getting started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial1.html">Part 1 - Send &amp; receive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial2.html">Part 2 - Route &amp; broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/tutorial3.html">Part 3 - Deploy to the web</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">How-to guides</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of How-to guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quick start</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">Upgrade to the new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code> implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheatsheet.html">Cheat sheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="patterns.html">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="autoreload.html">Reload on code changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="django.html">Integrate with Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="extensions.html">Write an extension</a></li>
<li class="toctree-l2"><a class="reference internal" href="render.html">Deploy to Render</a></li>
<li class="toctree-l2"><a class="reference internal" href="fly.html">Deploy to Fly</a></li>
<li class="toctree-l2"><a class="reference internal" href="heroku.html">Deploy to Heroku</a></li>
<li class="toctree-l2"><a class="reference internal" href="kubernetes.html">Deploy to Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="supervisor.html">Deploy with Supervisor</a></li>
<li class="toctree-l2"><a class="reference internal" href="nginx.html">Deploy behind nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="haproxy.html">Deploy behind HAProxy</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="sansio.html#">Integrate the Sans-I/O layer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../faq/index.html">Frequently asked questions</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Frequently asked questions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/server.html">Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/client.html">Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/common.html">Both sides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/asyncio.html">Using asyncio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/features.html">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/server.html">Server (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/asyncio/client.html">Client (new <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/server.html">Server (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sync/client.html">Client (<code class="xref py py-mod docutils literal notranslate"><span class="pre">threading</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/server.html">Server (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/sansio/client.html">Client (Sans-I/O)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/server.html">Server (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/legacy/client.html">Client (legacy <code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/extensions.html">Extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/datastructures.html">Data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/exceptions.html">Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/variables.html">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../topics/index.html">Topic guides</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Topic guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../topics/deployment.html">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/broadcast.html">Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/compression.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/keepalive.html">Keepalive and latency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/memory.html">Memory and buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../topics/performance.html">Performance</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../project/index.html">About websockets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of About websockets</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../project/changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/sponsoring.html">Sponsoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/tidelift.html">For enterprise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/support.html">Getting support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/license.html">License</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="sansio.html#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="integrate-the-sans-i-o-layer">
<h1>Integrate the Sans-I/O layer<a class="headerlink" href="sansio.html#integrate-the-sans-i-o-layer" title="Link to this heading">¶</a></h1>
<p>This guide explains how to integrate the <a class="reference external" href="https://sans-io.readthedocs.io/">Sans-I/O</a> layer of websockets to
add support for WebSocket in another library.</p>
<p>As a prerequisite, you should decide how you will handle network I/O and
asynchronous control flow.</p>
<p>Your integration layer will provide an API for the application on one side,
will talk to the network on the other side, and will rely on websockets to
implement the protocol in the middle.</p>
<img alt="../_images/data-flow.svg" class="align-center" src="../_images/data-flow.svg" />
<section id="opening-a-connection">
<h2>Opening a connection<a class="headerlink" href="sansio.html#opening-a-connection" title="Link to this heading">¶</a></h2>
<section id="client-side">
<h3>Client-side<a class="headerlink" href="sansio.html#client-side" title="Link to this heading">¶</a></h3>
<p>If you’re building a client, parse the URI you’d like to connect to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.uri</span> <span class="kn">import</span> <span class="n">parse_uri</span>

<span class="n">wsuri</span> <span class="o">=</span> <span class="n">parse_uri</span><span class="p">(</span><span class="s2">&quot;ws://example.com/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Open a TCP connection to <code class="docutils literal notranslate"><span class="pre">(wsuri.host,</span> <span class="pre">wsuri.port)</span></code> and perform a TLS
handshake if <code class="docutils literal notranslate"><span class="pre">wsuri.secure</span></code> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>.</p>
<p>Initialize a <a class="reference internal" href="../reference/sansio/client.html#websockets.client.ClientProtocol" title="websockets.client.ClientProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientProtocol</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.client</span> <span class="kn">import</span> <span class="n">ClientProtocol</span>

<span class="n">protocol</span> <span class="o">=</span> <span class="n">ClientProtocol</span><span class="p">(</span><span class="n">wsuri</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a WebSocket handshake request
with <a class="reference internal" href="../reference/sansio/client.html#websockets.client.ClientProtocol.connect" title="websockets.client.ClientProtocol.connect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connect()</span></code></a> and send it
with <a class="reference internal" href="../reference/sansio/client.html#websockets.client.ClientProtocol.send_request" title="websockets.client.ClientProtocol.send_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_request()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">request</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">protocol</span><span class="o">.</span><span class="n">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> and send its output to
the network, as described in <a class="reference internal" href="sansio.html#send-data">Send data</a> below.</p>
<p>Once you receive enough data, as explained in <a class="reference internal" href="sansio.html#receive-data">Receive data</a> below, the first
event returned by <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.events_received" title="websockets.protocol.Protocol.events_received"><code class="xref py py-meth docutils literal notranslate"><span class="pre">events_received()</span></code></a> is the WebSocket
handshake response.</p>
<p>When the handshake fails, the reason is available in
<a class="reference internal" href="../reference/sansio/client.html#websockets.client.ClientProtocol.handshake_exc" title="websockets.client.ClientProtocol.handshake_exc"><code class="xref py py-attr docutils literal notranslate"><span class="pre">handshake_exc</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">protocol</span><span class="o">.</span><span class="n">handshake_exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">protocol</span><span class="o">.</span><span class="n">handshake_exc</span>
</pre></div>
</div>
<p>Else, the WebSocket connection is open.</p>
<p>A WebSocket client API usually performs the handshake then returns a wrapper
around the network socket and the <a class="reference internal" href="../reference/sansio/client.html#websockets.client.ClientProtocol" title="websockets.client.ClientProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClientProtocol</span></code></a>.</p>
</section>
<section id="server-side">
<h3>Server-side<a class="headerlink" href="sansio.html#server-side" title="Link to this heading">¶</a></h3>
<p>If you’re building a server, accept network connections from clients and
perform a TLS handshake if desired.</p>
<p>For each connection, initialize a <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol" title="websockets.server.ServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerProtocol</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">websockets.server</span> <span class="kn">import</span> <span class="n">ServerProtocol</span>

<span class="n">protocol</span> <span class="o">=</span> <span class="n">ServerProtocol</span><span class="p">()</span>
</pre></div>
</div>
<p>Once you receive enough data, as explained in <a class="reference internal" href="sansio.html#receive-data">Receive data</a> below, the first
event returned by <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.events_received" title="websockets.protocol.Protocol.events_received"><code class="xref py py-meth docutils literal notranslate"><span class="pre">events_received()</span></code></a> is the WebSocket
handshake request.</p>
<p>Create a WebSocket handshake response
with <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol.accept" title="websockets.server.ServerProtocol.accept"><code class="xref py py-meth docutils literal notranslate"><span class="pre">accept()</span></code></a> and send it
with <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol.send_response" title="websockets.server.ServerProtocol.send_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_response()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">protocol</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you may reject the WebSocket handshake and return an HTTP
response with <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol.reject" title="websockets.server.ServerProtocol.reject"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reject()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">protocol</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">explanation</span><span class="p">)</span>
<span class="n">protocol</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> and send its output to
the network, as described in <a class="reference internal" href="sansio.html#send-data">Send data</a> below.</p>
<p>Even when you call <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol.accept" title="websockets.server.ServerProtocol.accept"><code class="xref py py-meth docutils literal notranslate"><span class="pre">accept()</span></code></a>, the WebSocket
handshake may fail if the request is incorrect or unsupported.</p>
<p>When the handshake fails, the reason is available in
<a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol.handshake_exc" title="websockets.server.ServerProtocol.handshake_exc"><code class="xref py py-attr docutils literal notranslate"><span class="pre">handshake_exc</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">protocol</span><span class="o">.</span><span class="n">handshake_exc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">protocol</span><span class="o">.</span><span class="n">handshake_exc</span>
</pre></div>
</div>
<p>Else, the WebSocket connection is open.</p>
<p>A WebSocket server API usually builds a wrapper around the network socket and
the <a class="reference internal" href="../reference/sansio/server.html#websockets.server.ServerProtocol" title="websockets.server.ServerProtocol"><code class="xref py py-class docutils literal notranslate"><span class="pre">ServerProtocol</span></code></a>. Then it invokes a connection handler that
accepts the wrapper in argument.</p>
<p>It may also provide a way to close all connections and to shut down the server
gracefully.</p>
<p>Going forwards, this guide focuses on handling an individual connection.</p>
</section>
</section>
<section id="from-the-network-to-the-application">
<h2>From the network to the application<a class="headerlink" href="sansio.html#from-the-network-to-the-application" title="Link to this heading">¶</a></h2>
<p>Go through the five steps below until you reach the end of the data stream.</p>
<section id="receive-data">
<h3>Receive data<a class="headerlink" href="sansio.html#receive-data" title="Link to this heading">¶</a></h3>
<p>When receiving data from the network, feed it to the protocol’s
<a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_data" title="websockets.protocol.Protocol.receive_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_data()</span></code></a> method.</p>
<p>When reaching the end of the data stream, call the protocol’s
<a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_eof" title="websockets.protocol.Protocol.receive_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_eof()</span></code></a> method.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">sock</span></code> is a <a class="reference external" href="https://docs.python.org/3/library/socket.html#socket.socket" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">socket</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">65536</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>  <span class="c1"># socket closed</span>
    <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="k">if</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">protocol</span><span class="o">.</span><span class="n">receive_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">protocol</span><span class="o">.</span><span class="n">receive_eof</span><span class="p">()</span>
</pre></div>
</div>
<p>These methods aren’t expected to raise exceptions — unless you call them again
after calling <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_eof" title="websockets.protocol.Protocol.receive_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_eof()</span></code></a>, which is an error.
(If you get an exception, please file a bug!)</p>
</section>
<section id="send-data">
<h3>Send data<a class="headerlink" href="sansio.html#send-data" title="Link to this heading">¶</a></h3>
<p>Then, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> and send its output to
the network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">protocol</span><span class="o">.</span><span class="n">data_to_send</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sock</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_WR</span><span class="p">)</span>
</pre></div>
</div>
<p>The empty bytestring signals the end of the data stream. When you see it, you
must half-close the TCP connection.</p>
<p>Sending data right after receiving data is necessary because websockets
responds to ping frames, close frames, and incorrect inputs automatically.</p>
</section>
<section id="expect-tcp-connection-to-close">
<h3>Expect TCP connection to close<a class="headerlink" href="sansio.html#expect-tcp-connection-to-close" title="Link to this heading">¶</a></h3>
<p>Closing a WebSocket connection normally involves a two-way WebSocket closing
handshake. Then, regardless of whether the closure is normal or abnormal, the
server starts the four-way TCP closing handshake. If the network fails at the
wrong point, you can end up waiting until the TCP timeout, which is very long.</p>
<p>To prevent dangling TCP connections when you expect the end of the data stream
but you never reach it, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.close_expected" title="websockets.protocol.Protocol.close_expected"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close_expected()</span></code></a>
and, if it returns <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, schedule closing the TCP connection after a
short timeout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># start a new execution thread to run this code</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  <span class="c1"># does nothing if the socket is already closed</span>
</pre></div>
</div>
<p>If the connection is still open when the timeout elapses, closing the socket
makes the execution thread that reads from the socket reach the end of the
data stream, possibly with an exception.</p>
</section>
<section id="close-tcp-connection">
<h3>Close TCP connection<a class="headerlink" href="sansio.html#close-tcp-connection" title="Link to this heading">¶</a></h3>
<p>If you called <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_eof" title="websockets.protocol.Protocol.receive_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_eof()</span></code></a>, close the TCP
connection now. This is a clean closure because the receive buffer is empty.</p>
<p>After <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_eof" title="websockets.protocol.Protocol.receive_eof"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_eof()</span></code></a> signals the end of the read
stream, <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> always signals the end of
the write stream, unless it already ended. So, at this point, the TCP
connection is already half-closed. The only reason for closing it now is to
release resources related to the socket.</p>
<p>Now you can exit the loop relaying data from the network to the application.</p>
</section>
<section id="receive-events">
<h3>Receive events<a class="headerlink" href="sansio.html#receive-events" title="Link to this heading">¶</a></h3>
<p>Finally, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.events_received" title="websockets.protocol.Protocol.events_received"><code class="xref py py-meth docutils literal notranslate"><span class="pre">events_received()</span></code></a> to obtain events
parsed from the data provided to <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.receive_data" title="websockets.protocol.Protocol.receive_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">receive_data()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">events</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">events_received</span><span class="p">()</span>
</pre></div>
</div>
<p>The first event will be the WebSocket opening handshake request or response.
See <a class="reference internal" href="sansio.html#opening-a-connection">Opening a connection</a> above for details.</p>
<p>All later events are WebSocket frames. There are two types of frames:</p>
<ul class="simple">
<li><p>Data frames contain messages transferred over the WebSocket connections. You
should provide them to the application. See <a class="reference internal" href="sansio.html#fragmentation">Fragmentation</a> below for
how to reassemble messages from frames.</p></li>
<li><p>Control frames provide information about the connection’s state. The main
use case is to expose an abstraction over ping and pong to the application.
Keep in mind that websockets responds to ping frames and close frames
automatically. Don’t duplicate this functionality!</p></li>
</ul>
</section>
</section>
<section id="from-the-application-to-the-network">
<h2>From the application to the network<a class="headerlink" href="sansio.html#from-the-application-to-the-network" title="Link to this heading">¶</a></h2>
<p>The connection object provides one method for each type of WebSocket frame.</p>
<p>For sending a data frame:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_continuation" title="websockets.protocol.Protocol.send_continuation"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_continuation()</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_text" title="websockets.protocol.Protocol.send_text"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_text()</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_binary" title="websockets.protocol.Protocol.send_binary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_binary()</span></code></a></p></li>
</ul>
<p>These methods raise <a class="reference internal" href="../reference/exceptions.html#websockets.exceptions.ProtocolError" title="websockets.exceptions.ProtocolError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ProtocolError</span></code></a> if you don’t set
the <a class="reference internal" href="../reference/datastructures.html#websockets.frames.Frame.fin" title="websockets.frames.Frame.fin"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FIN</span></code></a> bit correctly in fragmented
messages.</p>
<p>For sending a control frame:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_close" title="websockets.protocol.Protocol.send_close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_close()</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_ping" title="websockets.protocol.Protocol.send_ping"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_ping()</span></code></a></p></li>
<li><p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_pong" title="websockets.protocol.Protocol.send_pong"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_pong()</span></code></a></p></li>
</ul>
<p><a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_close" title="websockets.protocol.Protocol.send_close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_close()</span></code></a> initiates the closing handshake.
See <a class="reference internal" href="sansio.html#closing-a-connection">Closing a connection</a> below for details.</p>
<p>If you encounter an unrecoverable error and you must fail the WebSocket
connection, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.fail" title="websockets.protocol.Protocol.fail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fail()</span></code></a>.</p>
<p>After any of the above, call <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> and
send its output to the network, as shown in <a class="reference internal" href="sansio.html#send-data">Send data</a> above.</p>
<p>If you called <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.send_close" title="websockets.protocol.Protocol.send_close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send_close()</span></code></a>
or <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.fail" title="websockets.protocol.Protocol.fail"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fail()</span></code></a>, you expect the end of the data
stream. You should follow the process described in <a class="reference internal" href="sansio.html#close-tcp-connection">Close TCP connection</a>
above in order to prevent dangling TCP connections.</p>
</section>
<section id="closing-a-connection">
<h2>Closing a connection<a class="headerlink" href="sansio.html#closing-a-connection" title="Link to this heading">¶</a></h2>
<p>Under normal circumstances, when a server wants to close the TCP connection:</p>
<ul class="simple">
<li><p>it closes the write side;</p></li>
<li><p>it reads until the end of the stream, because it expects the client to close
the read side;</p></li>
<li><p>it closes the socket.</p></li>
</ul>
<p>When a client wants to close the TCP connection:</p>
<ul class="simple">
<li><p>it reads until the end of the stream, because it expects the server to close
the read side;</p></li>
<li><p>it closes the write side;</p></li>
<li><p>it closes the socket.</p></li>
</ul>
<p>Applying the rules described earlier in this document gives the intended
result. As a reminder, the rules are:</p>
<ul class="simple">
<li><p>When <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> returns the empty
bytestring, close the write side of the TCP connection.</p></li>
<li><p>When you reach the end of the read stream, close the TCP connection.</p></li>
<li><p>When <a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.close_expected" title="websockets.protocol.Protocol.close_expected"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close_expected()</span></code></a> returns <a class="reference external" href="https://docs.python.org/3/library/constants.html#True" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">True</span></code></a>, if
you don’t reach the end of the read stream quickly, close the TCP connection.</p></li>
</ul>
</section>
<section id="fragmentation">
<h2>Fragmentation<a class="headerlink" href="sansio.html#fragmentation" title="Link to this heading">¶</a></h2>
<p>WebSocket messages may be fragmented. Since this is a protocol-level concern,
you may choose to reassemble fragmented messages before handing them over to
the application.</p>
<p>To reassemble a message, read data frames until you get a frame where
the <a class="reference internal" href="../reference/datastructures.html#websockets.frames.Frame.fin" title="websockets.frames.Frame.fin"><code class="xref py py-attr docutils literal notranslate"><span class="pre">FIN</span></code></a> bit is set, then concatenate
the payloads of all frames.</p>
<p>You will never receive an inconsistent sequence of frames because websockets
raises a <a class="reference internal" href="../reference/exceptions.html#websockets.exceptions.ProtocolError" title="websockets.exceptions.ProtocolError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ProtocolError</span></code></a> and fails the connection when this
happens. However, you may receive an incomplete sequence if the connection
drops in the middle of a fragmented message.</p>
</section>
<section id="tips">
<h2>Tips<a class="headerlink" href="sansio.html#tips" title="Link to this heading">¶</a></h2>
<section id="serialize-operations">
<h3>Serialize operations<a class="headerlink" href="sansio.html#serialize-operations" title="Link to this heading">¶</a></h3>
<p>The Sans-I/O layer is designed to run sequentially. If you interact with it from
multiple threads or coroutines, you must ensure correct serialization.</p>
<p>Usually, this comes for free in a cooperative multitasking environment. In a
preemptive multitasking environment, it requires mutual exclusion.</p>
<p>Furthermore, you must serialize writes to the network. When
<a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.data_to_send" title="websockets.protocol.Protocol.data_to_send"><code class="xref py py-meth docutils literal notranslate"><span class="pre">data_to_send()</span></code></a> returns several values, you must write
them all before starting the next write.</p>
</section>
<section id="minimize-buffers">
<h3>Minimize buffers<a class="headerlink" href="sansio.html#minimize-buffers" title="Link to this heading">¶</a></h3>
<p>The Sans-I/O layer doesn’t perform any buffering. It makes events available in
<a class="reference internal" href="../reference/sansio/common.html#websockets.protocol.Protocol.events_received" title="websockets.protocol.Protocol.events_received"><code class="xref py py-meth docutils literal notranslate"><span class="pre">events_received()</span></code></a> as soon as they’re received.</p>
<p>You should make incoming messages available to the application immediately.</p>
<p>A small buffer of incoming messages will usually result in the best performance.
It will reduce context switching between the library and the application while
ensuring that backpressure is propagated.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../faq/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Frequently asked questions</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="haproxy.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Deploy behind HAProxy</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2013-2024, Aymeric Augustin and contributors
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="sansio.html#">Integrate the Sans-I/O layer</a><ul>
<li><a class="reference internal" href="sansio.html#opening-a-connection">Opening a connection</a><ul>
<li><a class="reference internal" href="sansio.html#client-side">Client-side</a></li>
<li><a class="reference internal" href="sansio.html#server-side">Server-side</a></li>
</ul>
</li>
<li><a class="reference internal" href="sansio.html#from-the-network-to-the-application">From the network to the application</a><ul>
<li><a class="reference internal" href="sansio.html#receive-data">Receive data</a></li>
<li><a class="reference internal" href="sansio.html#send-data">Send data</a></li>
<li><a class="reference internal" href="sansio.html#expect-tcp-connection-to-close">Expect TCP connection to close</a></li>
<li><a class="reference internal" href="sansio.html#close-tcp-connection">Close TCP connection</a></li>
<li><a class="reference internal" href="sansio.html#receive-events">Receive events</a></li>
</ul>
</li>
<li><a class="reference internal" href="sansio.html#from-the-application-to-the-network">From the application to the network</a></li>
<li><a class="reference internal" href="sansio.html#closing-a-connection">Closing a connection</a></li>
<li><a class="reference internal" href="sansio.html#fragmentation">Fragmentation</a></li>
<li><a class="reference internal" href="sansio.html#tips">Tips</a><ul>
<li><a class="reference internal" href="sansio.html#serialize-operations">Serialize operations</a></li>
<li><a class="reference internal" href="sansio.html#minimize-buffers">Minimize buffers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js%3Fv=03fa008d"></script>
    <script src="../_static/doctools.js%3Fv=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
    <script src="../_static/scripts/furo.js%3Fv=5fa4622c"></script>
    <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
    <script src="../_static/copybutton.js%3Fv=f281be69"></script>
    <script src="../_static/tabs.js%3Fv=3ee01567"></script>
    </body>
</html>